pipeline {
    agent any

    environment {
        // Define environment variables for the public and private repositories
        PUBLIC_IMAGE = "nginx:latest"
        PRIVATE_REPO = "my-private-repo.com/my-nginx"
        PRIVATE_IMAGE = "${PRIVATE_REPO}:latest"
    }

    stages {
        stage('Pull Public Image') {
            steps {
                script {
                    // Pull the public Docker image
                    sh "docker pull ${PUBLIC_IMAGE}"
                }
            }
        }

        stage('Tag Image for Private Repo') {
            steps {
                script {
                    // Tag the image for the private repository
                    sh "docker tag ${PUBLIC_IMAGE} ${PRIVATE_IMAGE}"
                }
            }
        }

        stage('Login to Private Repo') {
            steps {
                script {
                    // Log in to the private Docker repository
                    withCredentials([usernamePassword(credentialsId: 'docker-creds', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
                        sh "echo ${DOCKER_PASS} | docker login -u ${DOCKER_USER} --password-stdin ${PRIVATE_REPO}"
                    }
                }
            }
        }

        stage('Push to Private Repo') {
            steps {
                script {
                    // Push the tagged image to the private repository
                    sh "docker push ${PRIVATE_IMAGE}"
                }
            }
        }
    }

    post {
        success {
            echo "Docker image successfully cloned and pushed to the private repository!"
        }
        failure {
            echo "Failed to clone and push the Docker image."
        }
    }
}
